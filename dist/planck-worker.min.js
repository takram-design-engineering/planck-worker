!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(e.Planck=e.Planck||{})}(this,function(e){"use strict";function r(e,r){return e(r={exports:{}},r.exports),r.exports}for(var n=r(function(e){var r="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(r){var n=new Uint8Array(16);e.exports=function(){return r(n),n}}else{var t=new Array(16);e.exports=function(){for(var e,r=0;r<16;r++)0==(3&r)&&(e=4294967296*Math.random()),t[r]=e>>>((3&r)<<3)&255;return t}}}),t=[],o=0;o<256;++o)t[o]=(o+256).toString(16).substr(1);var i=function(e,r){var n=r||0,o=t;return o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]};var s=function(e,r,t){var o=r&&t||0;"string"==typeof e&&(r="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,r)for(var a=0;a<16;++a)r[o+a]=s[a];return r||i(s)},a=function(){try{if(new Function("return this === window")())return!0}catch(e){}return!1}(),u=!a&&function(){try{if(new Function("return this === self")())return!0}catch(e){}return!1}(),f=!a&&!u&&function(){try{if(new Function("return this === global")())return!0}catch(e){}return!1}(),c=a?window:u?self:f?global:void 0,l={isBrowser:a,isWorker:u,isNode:f,scope:c},v=r(function(e,r){function n(e,r){for(var n=0,t=e.length-1;t>=0;t--){var o=e[t];"."===o?e.splice(t,1):".."===o?(e.splice(t,1),n++):n&&(e.splice(t,1),n--)}if(r)for(;n--;n)e.unshift("..");return e}var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(e){return t.exec(e).slice(1)};function i(e,r){if(e.filter)return e.filter(r);for(var n=[],t=0;t<e.length;t++)r(e[t],t,e)&&n.push(e[t]);return n}r.resolve=function(){for(var e="",r=!1,t=arguments.length-1;t>=-1&&!r;t--){var o=t>=0?arguments[t]:process.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(e=o+"/"+e,r="/"===o.charAt(0))}return e=n(i(e.split("/"),function(e){return!!e}),!r).join("/"),(r?"/":"")+e||"."},r.normalize=function(e){var t=r.isAbsolute(e),o="/"===s(e,-1);return(e=n(i(e.split("/"),function(e){return!!e}),!t).join("/"))||t||(e="."),e&&o&&(e+="/"),(t?"/":"")+e},r.isAbsolute=function(e){return"/"===e.charAt(0)},r.join=function(){var e=Array.prototype.slice.call(arguments,0);return r.normalize(i(e,function(e,r){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},r.relative=function(e,n){function t(e){for(var r=0;r<e.length&&""===e[r];r++);for(var n=e.length-1;n>=0&&""===e[n];n--);return r>n?[]:e.slice(r,n-r+1)}e=r.resolve(e).substr(1),n=r.resolve(n).substr(1);for(var o=t(e.split("/")),i=t(n.split("/")),s=Math.min(o.length,i.length),a=s,u=0;u<s;u++)if(o[u]!==i[u]){a=u;break}var f=[];for(u=a;u<o.length;u++)f.push("..");return(f=f.concat(i.slice(a))).join("/")},r.sep="/",r.delimiter=":",r.dirname=function(e){var r=o(e),n=r[0],t=r[1];return n||t?(t&&(t=t.substr(0,t.length-1)),n+t):"."},r.basename=function(e,r){var n=o(e)[2];return r&&n.substr(-1*r.length)===r&&(n=n.substr(0,n.length-r.length)),n},r.extname=function(e){return o(e)[3]};var s="b"==="ab".substr(-1)?function(e,r,n){return e.substr(r,n)}:function(e,r,n){return r<0&&(r=e.length+r),e.substr(r,n)}}),h=(v.resolve,v.normalize,v.isAbsolute,v.join,v.relative,v.sep,v.delimiter,v.dirname,v.basename,v.extname,function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}),d=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),p=function(){return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,r){var n=[],t=!0,o=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(t=(s=a.next()).done)&&(n.push(s.value),!r||n.length!==r);t=!0);}catch(e){o=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),g=function(e){if(Array.isArray(e)){for(var r=0,n=Array(e.length);r<e.length;r++)n[r]=e[r];return n}return Array.from(e)};function m(e){var r=void 0,n=void 0;if("string"==typeof e)n=e,r=e;else{var t=Object.keys(e);r=e[n=p(t,1)[0]]}if(process.browser)return c[r];if(f)try{return require(n)}catch(e){}}function y(e){try{return m(e)}catch(e){c.process={browser:!f}}return m(e)}function w(e){var r=y(e);if(void 0===r){if(f)throw new Error('Could not resolve module "'+e+'"');return{}}return r}Object.assign(y,{optional:function(e){var r=y(e);return void 0===r?{}:r},required:function(e){var r=y(e);if(void 0===r)throw f?new Error('Could not resolve module "'+e+'"'):new Error('"'+e+'" isn’t defined in the global scope');return r},node:w,browser:function(e){var r=y(e);if(void 0===r){if(!f)throw new Error('"'+e+'" isn’t defined in the global scope');return{}}return r}});var b=w("path"),k={resolve:f?b.resolve:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return v.resolve.apply(v,["/"].concat(r))},normalize:f?b.normalize:v.normalize,join:f?b.join:v.join,relative:f?b.relative:v.relative,dirname:f?b.dirname:v.dirname,basename:f?b.basename:v.basename,extname:f?b.extname:v.extname,delimiter:f?b.delimiter:v.delimiter,sep:f?b.sep:v.sep};function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,r=Symbol(e);return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e};return void 0===e[r]&&(e[r]=n({})),e[r]}}var A=x("Worker");var E=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.name,t=r.path,o=void 0===t?k.self:t;h(this,e);var i=A(this);i.running=0,i.name=n||this.constructor.name,i.worker=new l.scope.Worker(o),i.worker.postMessage(i.name)}return d(e,[{key:"get",value:function(e,r,n){return"running"===r?Reflect.get(this,r):function(e,r){for(var n=arguments.length,t=Array(n>2?n-2:0),o=2;o<n;o++)t[o-2]=arguments[o];var i=this;return new Promise(function(n,o){var s=A(i),a=s.worker;a.addEventListener("message",function t(u){if(u.data.uuid===r&&(u.data.error?o(new Error(u.data.error)):n(i.constructor.transform(u.data.result,e)),a.removeEventListener("message",t,!1),--s.running,s.running<0))throw new Error},!1),a.postMessage({property:e,uuid:r,args:t}),++s.running})}.bind(this,r,s())}},{key:"running",get:function(){return A(this).running}}],[{key:"transform",value:function(e){return e}},{key:"inverseTransform",value:function(e){return e}},{key:"new",value:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return new Proxy({},new(Function.prototype.bind.apply(this,[null].concat(r))))}}]),e}(),j=function e(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];h(this,e),this.message=r,this.list=n},M=x("WorkerInstance"),P=function(){function e(){h(this,e),M(this).handleMessage=this.handleMessage.bind(this)}return d(e,[{key:"start",value:function(){if(!l.isWorker)throw new Error("Attempt to start worker instance on non-worker");var e=M(this);self.addEventListener("message",e.handleMessage,!1),console.log(this.constructor.name+" started")}},{key:"stop",value:function(){var e=M(this);self.removeEventListener("message",e.handleMessage,!1),console.log(this.constructor.name+" stopped")}},{key:"transfer",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];throw new j(e,r)}},{key:"handleMessage",value:function(){var e,r=(e=regeneratorRuntime.mark(function e(r){var n,t,o,i,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.data,t=n.property,o=n.uuid,i=n.args,s=void 0,e.prev=2,e.next=5,Promise.resolve(this[t].apply(this,g(i)));case 5:s=e.sent,e.next=16;break;case 8:if(e.prev=8,e.t0=e.catch(2),!(e.t0 instanceof j)){e.next=14;break}s=e.t0,e.next=16;break;case 14:throw self.postMessage({uuid:o,error:e.t0.message||e.t0}),e.t0;case 16:s instanceof j?self.postMessage({uuid:o,result:s.message},s.list):self.postMessage({uuid:o,result:s});case 17:case"end":return e.stop()}},e,this,[[2,8]])}),function(){var r=e.apply(this,arguments);return new Promise(function(e,n){return function t(o,i){try{var s=r[o](i),a=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});e(a)}("next")})});return function(e){return r.apply(this,arguments)}}()}],[{key:"register",value:function(){var e=this;self.addEventListener("message",function r(n){n.data===e.name&&((new e).start(),self.removeEventListener("message",r,!1))},!1)}}]),e}();e.Worker=E,e.WorkerInstance=P,Object.defineProperty(e,"__esModule",{value:!0})});