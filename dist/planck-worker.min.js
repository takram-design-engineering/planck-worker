!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(e.Planck={})}(this,function(e){"use strict";function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,r=Symbol(e);return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e};return void 0===e[r]&&(e[r]=n({})),e[r]}}function n(){return M.v4()}function t(e,r){for(var n=arguments.length,t=Array(n>2?n-2:0),o=2;o<n;o++)t[o-2]=arguments[o];var i=this;return new Promise(function(n,o){var a=C(i),u=a.worker;u.addEventListener("message",function t(o){if(o.data.uuid===r&&(n(i.constructor.transform(o.data.result,e)),u.removeEventListener("message",t,!1),--a.running,a.running<0))throw new Error},!1),u.postMessage({property:e,uuid:r,args:t}),++a.running})}var o=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),a=function(e){if(Array.isArray(e)){for(var r=0,n=Array(e.length);r<e.length;r++)n[r]=e[r];return n}return Array.from(e)},u=function(){function e(){o(this,e)}return i(e,null,[{key:"type",get:function(){try{if(new Function("return this === window")())return"browser"}catch(e){}try{if(new Function("return this === self")())return"worker"}catch(e){}try{if(new Function("return this === global")())return"node"}catch(e){}throw new Error}},{key:"self",get:function(){switch(this.type){case"browser":return window;case"worker":return self;case"node":return global}throw new Error}}]),e}(),s=r("FilePath"),c=function(){function e(){o(this,e)}return i(e,null,[{key:"self",get:function(){return s(this).self}},{key:"current",get:function(){switch(u.type){case"browser":var e=document.currentScript||document._currentScript;return e?e.src:null;case"worker":return self.location.href;case"node":return __filename}throw new Error}}]),e}();s(c).self=c.current;var f,l="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},d=l.crypto||l.msCrypto;if(d&&d.getRandomValues){var v=new Uint8Array(16);f=function(){return d.getRandomValues(v),v}}if(!f){var h=new Array(16);f=function(){for(var e,r=0;r<16;r++)0==(3&r)&&(e=4294967296*Math.random()),h[r]=e>>>((3&r)<<3)&255;return h}}for(var y=f,g=[],p=0;p<256;++p)g[p]=(p+256).toString(16).substr(1);var w=function(e,r){var n=r||0,t=g;return t[e[n++]]+t[e[n++]]+t[e[n++]]+t[e[n++]]+"-"+t[e[n++]]+t[e[n++]]+"-"+t[e[n++]]+t[e[n++]]+"-"+t[e[n++]]+t[e[n++]]+"-"+t[e[n++]]+t[e[n++]]+t[e[n++]]+t[e[n++]]+t[e[n++]]+t[e[n++]]},m=y(),k=[1|m[0],m[1],m[2],m[3],m[4],m[5]],b=16383&(m[6]<<8|m[7]),E=0,x=0,A=function(e,r,n){var t=r&&n||0;"string"==typeof e&&(r="binary"==e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||y)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,r)for(var i=0;i<16;++i)r[t+i]=o[i];return r||w(o)},T=A;T.v1=function(e,r,n){var t=r&&n||0,o=r||[],i=void 0!==(e=e||{}).clockseq?e.clockseq:b,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:x+1,s=a-E+(u-x)/1e4;if(s<0&&void 0===e.clockseq&&(i=i+1&16383),(s<0||a>E)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");E=a,x=u,b=i;var c=(1e4*(268435455&(a+=122192928e5))+u)%4294967296;o[t++]=c>>>24&255,o[t++]=c>>>16&255,o[t++]=c>>>8&255,o[t++]=255&c;var f=a/4294967296*1e4&268435455;o[t++]=f>>>8&255,o[t++]=255&f,o[t++]=f>>>24&15|16,o[t++]=f>>>16&255,o[t++]=i>>>8|128,o[t++]=255&i;for(var l=e.node||k,d=0;d<6;++d)o[t+d]=l[d];return r||w(o)},T.v4=A;var M=T,C=r("Worker"),D=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.name,t=r.path,i=void 0===t?c.self:t;o(this,e);var a=C(this);a.running=0,a.name=n||this.constructor.name,a.worker=new u.self.Worker(i),a.worker.postMessage(a.name)}return i(e,[{key:"get",value:function(e,r,o){return"running"===r?Reflect.get(this,r):t.bind(this,r,n())}},{key:"running",get:function(){return C(this).running}}],[{key:"transform",value:function(e){return e}},{key:"inverseTransform",value:function(e){return e}},{key:"new",value:function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return new Proxy({},new(Function.prototype.bind.apply(this,[null].concat(r))))}}]),e}(),S=function(e,r){return r={exports:{}},e(r,r.exports),r.exports}(function(e,r){!function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),t=0;t<e.length;t++)n[e.charCodeAt(t)]=t;r.encode=function(r){var n,t=new Uint8Array(r),o=t.length,i="";for(n=0;n<o;n+=3)i+=e[t[n]>>2],i+=e[(3&t[n])<<4|t[n+1]>>4],i+=e[(15&t[n+1])<<2|t[n+2]>>6],i+=e[63&t[n+2]];return o%3==2?i=i.substring(0,i.length-1)+"=":o%3==1&&(i=i.substring(0,i.length-2)+"=="),i},r.decode=function(e){var r,t,o,i,a,u=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(u--,"="===e[e.length-2]&&u--);var f=new ArrayBuffer(u),l=new Uint8Array(f);for(r=0;r<s;r+=4)t=n[e.charCodeAt(r)],o=n[e.charCodeAt(r+1)],i=n[e.charCodeAt(r+2)],a=n[e.charCodeAt(r+3)],l[c++]=t<<2|o>>4,l[c++]=(15&o)<<4|i>>2,l[c++]=(3&i)<<6|63&a;return f}}()});if("node"===u.type){var F=require("text-encoding");void 0===u.self.TextEncoder&&(u.self.TextEncoder=F.TextEncoder),void 0===u.self.TextDecoder&&(u.self.TextDecoder=F.TextDecoder)}var L=function(){function e(){o(this,e)}return i(e,null,[{key:"encode",value:function(e){if("function"!=typeof TextEncoder)throw new Error("TextEncoder is missing");var r=new TextEncoder,n=JSON.stringify(e);return r.encode(n).buffer}},{key:"decode",value:function(e){if("function"!=typeof TextDecoder)throw new Error("TextDecoder is missing");var r=new TextDecoder,n=new DataView(e),t=r.decode(n);return JSON.parse(t)}},{key:"pack",value:function(e){return S.encode(e)}},{key:"unpack",value:function(e){return S.decode(e)}},{key:"packBufferGeometry",value:function(e){var r=this;Object.values(e.data.attributes).forEach(function(e){var n=new(0,u.self[e.type])(e.array).buffer;e.array=r.pack(n)})}},{key:"unpackBufferGeometry",value:function(e){var r=this;Object.values(e.data.attributes).forEach(function(e){var n=u.self[e.type],t=r.unpack(e.array);e.array=Array.from(new n(t))})}}]),e}(),O=r("WorkerInstance"),P=function(){function e(){o(this,e),O(this).handleMessage=this.handleMessage.bind(this)}return i(e,[{key:"start",value:function(){var e;if("worker"!==u.type)throw new Error;var r=O(this);(e=u.self).importScripts.apply(e,a(this.constructor.imports.map(function(e){return c.resolve(e)}))),u.self.addEventListener("message",r.handleMessage,!1),console.log(this.constructor.name+" started")}},{key:"stop",value:function(){var e=O(this);u.self.removeEventListener("message",e.handleMessage,!1),console.log(this.constructor.name+" stopped")}},{key:"post",value:function(e,r){u.self.postMessage({uuid:e,result:r})}},{key:"transfer",value:function(e,r){if(void 0===r)u.self.postMessage({uuid:e});else{var n=L.encode(r);u.self.postMessage({uuid:e,result:n},[n])}}},{key:"handleMessage",value:function(e){var r=e.data,n=r.property,t=r.uuid,o=r.args;if("function"!=typeof this[n])throw new Error('Function was not found for "'+n+'"');this[n].apply(this,[t].concat(a(o)))}}],[{key:"register",value:function(){var e=this;u.self.addEventListener("message",function r(n){n.data===e.name&&((new e).start(),u.self.removeEventListener("message",r,!1))},!1)}},{key:"imports",get:function(){return[]}}]),e}();e.Worker=D,e.WorkerInstance=P,Object.defineProperty(e,"__esModule",{value:!0})});